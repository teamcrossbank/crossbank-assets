{% comment %}
  Section: main-blog-grid.liquid
  Purpose: Mobile-first blog with billiards accents
  - Featured hero (latest post), compact list below
  - Hover/tap polish (image lift, glow, underline)
  - Theme accent switch (felt vs chalk)
  - CTA fixed: 8-ball icon + readable label
  Theme: Dawn 15.4+
{% endcomment %}

<section id="blog-grid-{{ section.id }}"
  class="blog-grid color-{{ section.settings.color_scheme }} theme-{{ section.settings.theme_accent }}">

  {%- comment -%} Optional subtle page background image (felt/chalk you upload) {%- endcomment -%}
  {% if section.settings.bg_image != blank %}
    {% assign bg_1200 = section.settings.bg_image | image_url: width: 1200 %}
    {% assign bg_1600 = section.settings.bg_image | image_url: width: 1600 %}
    <style>
      #blog-grid-{{ section.id }} {
        --cbk-bg-url: url('{{ bg_1200 }}');
        background-image: var(--cbk-bg-url);
        background-size: {{ section.settings.bg_size }};
        background-position: {{ section.settings.bg_position }};
        background-repeat: {{ section.settings.bg_repeat }};
      }
      @media (min-width: 990px){
        #blog-grid-{{ section.id }} { --cbk-bg-url: url('{{ bg_1600 }}'); }
      }
    </style>
  {% endif %}

  <div class="page-width">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <header class="blog-head">
        {% if section.settings.heading != blank %}
          <h1 class="blog-head__title">{{ section.settings.heading | escape }}</h1>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="blog-head__subtitle">{{ section.settings.subheading | escape }}</p>
        {% endif %}
      </header>
    {% endif %}

    {% paginate blog.articles by 50 %}
      {% if blog.articles_count == 0 %}
        <div class="blog-empty"><p>No articles yet. Come back soon.</p></div>
      {% else %}

        {%- comment -%} FEATURED HERO on first page {%- endcomment -%}
        {% if section.settings.show_hero and paginate.current_page == 1 %}
          {% assign hero = nil %}
          {% for a in blog.articles limit:1 %}{% assign hero = a %}{% endfor %}
          {% if hero %}
            <article class="hero">
              <a class="hero__media" href="{{ hero.url }}" aria-label="{{ hero.title | escape }}">
                {% assign alt_text = hero.image.alt | default: hero.title %}
                {% if hero.image %}
                  {% assign h960 = hero.image | image_url: width: 960 %}
                  {% assign h1440 = hero.image | image_url: width: 1440 %}
                  {% if section.settings.hero_ratio == '4x3' %}
                    {% assign hw = 1200 %}
                    {% assign hh = 900 %}
                  {% else %}
                    {% assign hw = 1440 %}
                    {% assign hh = 810 %}
                  {% endif %}
                  <img
                    class="hero__img hero__img--{{ section.settings.hero_ratio }}"
                    src="{{ h960 }}"
                    srcset="{{ h960 }} 960w, {{ h1440 }} 1440w"
                    sizes="(min-width: 990px) 66vw, 100vw"
                    alt="{{ alt_text | escape }}"
                    loading="lazy"
                    width="{{ hw }}"
                    height="{{ hh }}"
                    decoding="async">
                {% else %}
                  <div class="hero__placeholder hero__img--{{ section.settings.hero_ratio }}" aria-hidden="true">
                    <svg viewBox="0 0 160 90" xmlns="http://www.w3.org/2000/svg" class="hero__svg">
                      <rect x="0" y="0" width="160" height="90" fill="currentColor" opacity="0.06"/>
                      <circle cx="80" cy="45" r="18" fill="none" stroke="currentColor" stroke-width="3"/>
                      <text x="80" y="50" text-anchor="middle" font-size="14" fill="currentColor" opacity="0.7">8</text>
                    </svg>
                  </div>
                {% endif %}
                <div class="hero__overlay"></div>
              </a>
              <div class="hero__content">
                <h2 class="hero__title"><a href="{{ hero.url }}">{{ hero.title | escape }}</a></h2>
                <div class="hero__meta">
                  <time datetime="{{ hero.published_at | date: "%Y-%m-%d" }}">{{ hero.published_at | date: format: "date" }}</time>
                  {% assign words = hero.content | strip_html | split: ' ' | size %}
                  {% assign minutes = words | divided_by: 200 | ceil %}
                  <span class="dot">•</span><span>{{ minutes }} min read</span>
                </div>
                {% assign preview_h = hero.excerpt_or_content | strip_html | truncate: 120, '…' %}
                <p class="hero__excerpt">{{ preview_h }}</p>
                <a class="cta cta--pill" href="{{ hero.url }}"><span class="cta__ball">8</span><span class="cta__label">{{ section.settings.cta_label }}</span></a>
              </div>
            </article>

            <div class="cue-divider" aria-hidden="true"></div>
          {% endif %}
        {% endif %}

        {%- comment -%} LIST ITEMS (offset hero when shown on page 1) {%- endcomment -%}
        <ul class="post-list" role="list">
          {% if section.settings.show_hero and paginate.current_page == 1 %}
            {% assign offset_val = 1 %}
          {% else %}
            {% assign offset_val = 0 %}
          {% endif %}

          {% for article in blog.articles offset: offset_val %}
            <li class="post">
              <article class="post__card">
                <a class="post__media" href="{{ article.url }}" aria-label="{{ article.title | escape }}">
                  {% assign thumb_w = 112 %}
                  {% assign thumb_h = 84 %}
                  {% if section.settings.thumb_ratio == '1x1' %}
                    {% assign thumb_w = 100 %}
                    {% assign thumb_h = 100 %}
                  {% endif %}

                  {% if article.image %}
                    {% assign alt_text = article.image.alt | default: article.title %}
                    {% assign w240  = article.image | image_url: width: 240 %}
                    {% assign w360  = article.image | image_url: width: 360 %}
                    {% assign w480  = article.image | image_url: width: 480 %}
                    <img
                      class="post__img post__img--{{ section.settings.thumb_ratio }}"
                      src="{{ w360 }}"
                      srcset="{{ w240 }} 240w, {{ w360 }} 360w, {{ w480 }} 480w"
                      sizes="(min-width: 990px) 200px, 112px"
                      alt="{{ alt_text | escape }}"
                      loading="lazy"
                      width="{{ thumb_w }}"
                      height="{{ thumb_h }}"
                      decoding="async">
                  {% else %}
                    <div class="post__placeholder post__img--{{ section.settings.thumb_ratio }}" aria-hidden="true">
                      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="post__svg">
                        <rect x="0" y="0" width="100" height="100" fill="currentColor" opacity="0.06"/>
                        <circle cx="50" cy="50" r="22" fill="none" stroke="currentColor" stroke-width="3"/>
                        <text x="50" y="56" text-anchor="middle" font-size="16" fill="currentColor" opacity="0.7">8</text>
                      </svg>
                    </div>
                  {% endif %}
                </a>

                <div class="post__content">
                  <h3 class="post__title"><a href="{{ article.url }}">{{ article.title | escape }}</a></h3>

                  {% if section.settings.show_meta %}
                    <div class="post__meta">
                      {% if section.settings.show_date %}
                        <time class="post__date" datetime="{{ article.published_at | date: "%Y-%m-%d" }}">
                          {{ article.published_at | date: format: "date" }}
                        </time>
                      {% endif %}
                      {% if section.settings.show_read_time %}
                        {% assign words = article.content | strip_html | split: ' ' | size %}
                        {% assign minutes = words | divided_by: 200 | ceil %}
                        <span class="dot">•</span><span>{{ minutes }} min read</span>
                      {% endif %}
                    </div>
                  {% endif %}

                  {% if section.settings.show_excerpt %}
                    {% assign preview = article.excerpt_or_content | strip_html | truncate: section.settings.excerpt_length, '…' %}
                    <p class="post__excerpt">{{ preview }}</p>
                  {% endif %}

                  <a class="cta cta--inline" href="{{ article.url }}">
                    <span class="cta__ball">8</span>
                    <span class="cta__label">{{ section.settings.cta_label }}</span>
                  </a>
                </div>
              </article>
              {% unless forloop.last %}<div class="cue-divider" aria-hidden="true"></div>{% endunless %}
            </li>
          {% endfor %}
        </ul>

        {% if paginate.pages > 1 %}
          <nav class="blog-pagination" role="navigation" aria-label="Pagination">
            {% if paginate.previous %}<a href="{{ paginate.previous.url }}" class="button button--secondary">Newer</a>{% endif %}
            <span class="blog-pagination__page">Page {{ paginate.current_page }} of {{ paginate.pages }}</span>
            {% if paginate.next %}<a href="{{ paginate.next.url }}" class="button">{{ section.settings.load_more_label }}</a>{% endif %}
          </nav>
        {% endif %}

      {% endif %}
    {% endpaginate %}
  </div>

  {{ 'blog-grid.css' | asset_url | stylesheet_tag }}
</section>

{% schema %}
{
  "name": "Blog grid compact",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "The Art of Billiards" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Stories, tips, and debates from the pool hall." },

    { "type": "checkbox", "id": "show_hero", "label": "Show featured hero (latest post)", "default": true },
    {
      "type": "select", "id": "hero_ratio", "label": "Hero image ratio", "default": "16x9",
      "options": [ { "value": "16x9", "label": "16:9" }, { "value": "4x3", "label": "4:3" } ]
    },

    { "type": "checkbox", "id": "show_meta", "label": "Show meta row", "default": true },
    { "type": "checkbox", "id": "show_date", "label": "Show published date", "default": true },
    { "type": "checkbox", "id": "show_read_time", "label": "Show read time", "default": true },
    { "type": "checkbox", "id": "show_excerpt", "label": "Show excerpt", "default": true },
    { "type": "range", "id": "excerpt_length", "label": "Excerpt length (characters)", "min": 60, "max": 200, "step": 5, "default": 110 },

    {
      "type": "select", "id": "thumb_ratio", "label": "Thumbnail ratio", "default": "4x3",
      "options": [ { "value": "4x3", "label": "4:3 (recommended)" }, { "value": "1x1", "label": "1:1 Square" } ]
    },

    { "type": "image_picker", "id": "bg_image", "label": "Optional background image (felt or chalk texture)" },
    {
      "type": "select", "id": "bg_size", "label": "Background size", "default": "cover",
      "options": [ { "value": "cover", "label": "Cover" }, { "value": "contain", "label": "Contain" }, { "value": "auto", "label": "Actual size (repeatable)" } ]
    },
    {
      "type": "select", "id": "bg_position", "label": "Background position", "default": "center center",
      "options": [ { "value": "center center", "label": "Center" }, { "value": "top center", "label": "Top" }, { "value": "bottom center", "label": "Bottom" } ]
    },
    {
      "type": "select", "id": "bg_repeat", "label": "Background repeat", "default": "no-repeat",
      "options": [ { "value": "no-repeat", "label": "No repeat" }, { "value": "repeat", "label": "Repeat" }, { "value": "repeat-x", "label": "Repeat X" }, { "value": "repeat-y", "label": "Repeat Y" } ]
    },

    { "type": "range", "id": "bg_overlay", "label": "Background darken overlay (0–25%)", "min": 0, "max": 25, "step": 1, "default": 6 },

    {
      "type": "select", "id": "theme_accent", "label": "Theme accent", "default": "felt",
      "options": [ { "value": "felt", "label": "Felt green vibe" }, { "value": "chalk", "label": "Chalkboard vibe" } ]
    },

    {
      "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "background-1",
      "options": [
        { "value": "background-1", "label": "Background 1" },
        { "value": "background-2", "label": "Background 2" },
        { "value": "inverse", "label": "Inverse" },
        { "value": "accent-1", "label": "Accent 1" },
        { "value": "accent-2", "label": "Accent 2" }
      ]
    },

    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Read" },
    { "type": "text", "id": "load_more_label", "label": "Pagination next label", "default": "Older" }
  ],
  "presets": [ { "name": "Blog grid compact", "category": "Blog" } ]
}
{% endschema %}

{% stylesheet %}{% endstylesheet %}
{% javascript %}{% endjavascript %}
