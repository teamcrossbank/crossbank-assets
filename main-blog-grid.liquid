{% comment %}
  Section: main-blog-grid.liquid
  Purpose: Mobile-first blog with billiards accents
  - Featured hero (latest post), compact list below
  - Hover/tap polish (image lift, glow, underline)
  - Theme accent switch (felt vs chalk)
  - CTA fixed: 8-ball icon + readable label
  Theme: Dawn 15.4+
{% endcomment %}

<section id="blog-grid-{{ section.id }}"
  class="blog-grid color-{{ section.settings.color_scheme }} theme-{{ section.settings.theme_accent }}">

  {%- comment -%} Optional subtle page background image (felt/chalk you upload) {%- endcomment -%}
  {% if section.settings.bg_image != blank %}
    {% assign bg_1200 = section.settings.bg_image | image_url: width: 1200 %}
    {% assign bg_1600 = section.settings.bg_image | image_url: width: 1600 %}
    <style>
      #blog-grid-{{ section.id }} {
        --cbk-bg-url: url('{{ bg_1200 }}');
        background-image: var(--cbk-bg-url);
        background-size: {{ section.settings.bg_size }};
        background-position: {{ section.settings.bg_position }};
        background-repeat: {{ section.settings.bg_repeat }};
      }
      @media (min-width: 990px){
        #blog-grid-{{ section.id }} { --cbk-bg-url: url('{{ bg_1600 }}'); }
      }
    </style>
  {% endif %}

  <div class="page-width">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <header class="blog-head">
        {% if section.settings.heading != blank %}
          <h1 class="blog-head__title">{{ section.settings.heading | escape }}</h1>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="blog-head__subtitle">{{ section.settings.subheading | escape }}</p>
        {% endif %}
      </header>
    {% endif %}

    {% paginate blog.articles by 50 %}
      {% if blog.articles_count == 0 %}
        <div class="blog-empty"><p>No articles yet. Come back soon.</p></div>
      {% else %}

        {%- comment -%} FEATURED HERO on first page {%- endcomment -%}
        {% if section.settings.show_hero and paginate.current_page == 1 %}
          {% assign hero = blog.articles | first %}
          {% if hero %}
            <article class="hero">
              <a class="hero__media" href="{{ hero.url }}" aria-label="{{ hero.title | escape }}">
                {% assign alt_text = hero.image.alt | default: hero.title %}
                {% if hero.image %}
                  {% assign h960 = hero.image | image_url: width: 960 %}
                  {% assign h1440 = hero.image | image_url: width: 1440 %}
                  {% if section.settings.hero_ratio == '4x3' %}
                    {% assign hw = 1200 %}{% assign hh = 900 %}
                  {% else %}
                    {% assign hw = 1440 %}{% assign hh = 810 %}
                  {% endif %}
                  <img
                    class="hero__img hero__img--{{ section.settings.hero_ratio }}"
                    src="{{ h960 }}"
                    srcset="{{ h960 }} 960w, {{ h1440 }} 1440w"
                    sizes="(min-width: 990px) 66vw, 100vw"
                    alt="{{ alt_text | escape }}"
                    loading="lazy"
                    width="{{ hw }}"
                    height="{{ hh }}"
                    decoding="async">
                {% else %}
                  <div class="hero__placeholder hero__img--{{ section.settings.hero_ratio }}" aria-hidden="true">
                    <svg viewBox="0 0 160 90" xmlns="http://www.w3.org/2000/svg" class="hero__svg">
                      <rect x="0" y="0" width="160" height="90" fill="currentColor" opacity="0.06"/>
                      <circle cx="80" cy="45" r="18" fill="none" stroke="currentColor" stroke-width="3"/>
                      <text x="80" y="50" text-anchor="middle" font-size="14" fill="currentColor" opacity="0.7">8</text>
                    </svg>
                  </div>
                {% endif %}
                <div class="hero__overlay"></div>
              </a>
              <div class="hero__content">
                <h2 class="hero__title"><a href="{{ hero.url }}">{{ hero.title | escape }}</a></h2>
                <div class="hero__meta">
                  <time datetime="{{ hero.published_at | date: "%Y-%m-%d" }}">{{ hero.published_at | date: format: "date" }}</time>
                  {% assign words = hero.content | strip_html | split: ' ' | size %}
                  {% assign minutes = words | divided_by: 200 %}{% if minutes < 1 %}{% assign minutes = 1 %}{% endif %}
                  <span class="dot">•</span><span>{{ minutes }} min read</span>
                </div>
                {% assign preview_h = hero.excerpt_or_content | strip_html | truncate: 120, '…' %}
                <p class="hero__excerpt">{{ preview_h }}</p>
                <a class="cta cta--pill" href="{{ hero.url }}"><span class="cta__ball">8</span><span class="cta__label">{{ section.settings.cta_label }}</span></a>
              </div>
            </article>

            <div class="cue-divider" aria-hidden="true"></div>
          {% endif %}
        {% endif %}

        {%- comment -%} LIST ITEMS (offset hero when shown on page 1) {%- endcomment -%}
        <ul class="post-list" role="list">
          {% if section.settings.show_hero and paginate.current_page == 1 %}
            {% assign offset_val = 1 %}
          {% else %}
            {% assign offset_val = 0 %}
          {% endif %}

          {% for article in blog.articles offset: offset_val %}
            <li class="post">
              <article class="post__card">
                <a class="post__media" href="{{ article.url }}" aria-label="{{ article.title | escape }}">
                  {% assign thumb_w = 112 %}{% assign thumb_h = 84 %}
                  {% if section.settings.thumb_ratio == '1x1' %}{% assign thumb_w = 100 %}{% assign thumb_h = 100 %}{% endif %}

                  {% if article.image %}
                    {% assign alt_text = article.image.alt | default: article.title %}
                    {% assign w240  = article.image | image_url: width: 240 %}
                    {% assign w360  = article.image | image_url: width: 360 %}
                    {% assign w480  = article.image | image_url: width: 480 %}
                    <img
                      class="post__img post__img--{{ section.settings.thumb_ratio }}"
                      src="{{ w360 }}"
                      srcset="{{ w240 }} 240w, {{ w360 }} 360w, {{ w480 }} 480w"
                      sizes="(min-width: 990px) 200px, 112px"
                      alt="{{ alt_text | escape }}"
                      loading="lazy"
                      width="{{ thumb_w }}"
                      height="{{ thumb_h }}"
                      decoding="async">
                  {% else %}
                    <div class="post__placeholder post__img--{{ section.settings.thumb_ratio }}" aria-hidden="true">
                      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="post__svg">
                        <rect x="0" y="0" width="100" height="100" fill="currentColor" opacity="0.06"/>
                        <circle cx="50" cy="50" r="22" fill="none" stroke="currentColor" stroke-width="3"/>
                        <text x="50" y="56" text-anchor="middle" font-size="16" fill="currentColor" opacity="0.7">8</text>
                      </svg>
                    </div>
                  {% endif %}
                </a>

                <div class="post__content">
                  <h3 class="post__title"><a href="{{ article.url }}">{{ article.title | escape }}</a></h3>

                  {% if section.settings.show_meta %}
                    <div class="post__meta">
                      {% if section.settings.show_date %}
                        <time class="post__date" datetime="{{ article.published_at | date: "%Y-%m-%d" }}">
                          {{ article.published_at | date: format: "date" }}
                        </time>
                      {% endif %}
                      {% if section.settings.show_read_time %}
                        {% assign words = article.content | strip_html | split: ' ' | size %}
                        {% assign minutes = words | divided_by: 200 %}{% if minutes < 1 %}{% assign minutes = 1 %}{% endif %}
                        <span class="dot">•</span><span>{{ minutes }} min read</span>
                      {% endif %}
                    </div>
                  {% endif %}

                  {% if section.settings.show_excerpt %}
                    {% assign preview = article.excerpt_or_content | strip_html | truncate: section.settings.excerpt_length, '…' %}
                    <p class="post__excerpt">{{ preview }}</p>
                  {% endif %}

                  <a class="cta cta--inline" href="{{ article.url }}">
                    <span class="cta__ball">8</span>
                    <span class="cta__label">{{ section.settings.cta_label }}</span>
                  </a>
                </div>
              </article>
              {% unless forloop.last %}<div class="cue-divider" aria-hidden="true"></div>{% endunless %}
            </li>
          {% endfor %}
        </ul>

        {% if paginate.pages > 1 %}
          <nav class="blog-pagination" role="navigation" aria-label="Pagination">
            {% if paginate.previous %}<a href="{{ paginate.previous.url }}" class="button button--secondary">Newer</a>{% endif %}
            <span class="blog-pagination__page">Page {{ paginate.current_page }} of {{ paginate.pages }}</span>
            {% if paginate.next %}<a href="{{ paginate.next.url }}" class="button">{{ section.settings.load_more_label }}</a>{% endif %}
          </nav>
        {% endif %}

      {% endif %}
    {% endpaginate %}
  </div>

  <style>
    /* Shell + accent variables that actually change with Theme select */
    #blog-grid-{{ section.id }} { position: relative; }
    #blog-grid-{{ section.id }} .page-width { max-width: var(--page-width, 1100px); margin: 0 auto; padding: 0 1rem; }

    /* Felt accent */
    #blog-grid-{{ section.id }}.theme-felt {
      --cbk-accent: #0e6d3b;         /* deep felt green */
      --cbk-accent-2: #14a057;       /* brighter felt */
      --cbk-divider-wood-1: rgba(122,84,40,.9);
      --cbk-divider-wood-2: rgba(191,140,74,.95);
      --cbk-cta-bg: #111;
    }
    /* Chalk accent */
    #blog-grid-{{ section.id }}.theme-chalk {
      --cbk-accent: #2b2f33;         /* slate */
      --cbk-accent-2: #4b5258;       /* lighter slate */
      --cbk-divider-wood-1: rgba(80,80,80,.9);
      --cbk-divider-wood-2: rgba(140,140,140,.95);
      --cbk-cta-bg: #111;
    }

    /* Optional overlay tint for readability */
    #blog-grid-{{ section.id }}.theme-felt::before,
    #blog-grid-{{ section.id }}.theme-chalk::before{
      content:""; position: absolute; inset: 0; pointer-events: none;
      background: rgba(0,0,0, {{ section.settings.bg_overlay | divided_by: 100.0 }});
    }

    .blog-head { padding: 1rem 0 .5rem; }
    .blog-head__title { font-size: clamp(1.4rem, 4.5vw, 2rem); margin: 0; line-height: 1.15; }
    .blog-head__subtitle { margin: .35rem 0 0; opacity: .88; }

    /* HERO */
    .hero {
      position: relative; border-radius: 16px; overflow: hidden; margin: .4rem 0 1rem;
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
    }
    .hero__img--16x9 { aspect-ratio: 16 / 9; width: 100%; height: auto; object-fit: cover; display:block; }
    .hero__img--4x3  { aspect-ratio: 4 / 3;  width: 100%; height: auto; object-fit: cover; display:block; }
    .hero__overlay { position:absolute; inset:0; background: linear-gradient(to top, rgba(0,0,0,.45) 0%, rgba(0,0,0,.1) 60%, rgba(0,0,0,0) 100%); }
    .hero__content {
      position: absolute; left: 0; right: 0; bottom: 0; padding: 1rem;
      color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,.35);
    }
    .hero__title { margin: 0 0 .25rem; font-size: clamp(1.2rem, 5vw, 1.6rem); line-height: 1.2; }
    .hero__title a { color: #fff; text-decoration: none; border-bottom: 2px solid transparent; }
    .hero__title a:hover { border-color: var(--cbk-accent-2); }
    .hero__meta { display:flex; gap:.5rem; align-items:center; font-size:.93rem; opacity:.95; }
    .hero__excerpt { margin:.35rem 0 .55rem; max-width: 60ch; }

    /* LIST */
    .post-list { list-style: none; margin: .5rem 0 2rem; padding: 0; }
    .post__card {
      display: grid; grid-template-columns: 112px 1fr; gap: .75rem; align-items: start;
      background: var(--color-background, #fff);
      border-radius: 12px; padding: .6rem;
      transition: box-shadow .14s ease, transform .14s ease;
    }
    .post__card:hover { box-shadow: 0 10px 24px rgba(0,0,0,.10); transform: translateY(-1px); }
    .post__media { display:block; border-radius: 10px; overflow: hidden; }
    .post__img--4x3 { aspect-ratio: 4 / 3; width: 112px; height: 84px; object-fit: cover; transition: transform .25s ease; }
    .post__img--1x1 { aspect-ratio: 1 / 1; width: 100px; height: 100px; object-fit: cover; transition: transform .25s ease; }
    .post__card:hover .post__img--4x3, .post__card:hover .post__img--1x1 { transform: scale(1.03); }
    .post__placeholder { display:grid; place-items:center; background: rgba(0,0,0,.035); color: currentColor; border-radius:10px; }
    .post__svg { width: 60%; height: auto; }

    .post__content { display:flex; flex-direction: column; gap: .35rem; }
    .post__title { font-size: clamp(1.02rem, 2.8vw, 1.2rem); margin: .1rem 0 0; line-height:1.25; }
    .post__title a { text-decoration: none; color: var(--color-foreground, inherit); border-bottom: 2px solid transparent; }
    .post__title a:hover { border-color: var(--cbk-accent); }

    .post__meta { font-size: .9rem; opacity: .85; display:flex; align-items:center; gap:.4rem; }
    .dot { opacity: .6; }
    .post__excerpt { margin: .2rem 0 .2rem; opacity: .92; font-size: .95rem; }

    /* CTA styles (fix: readable label + 8-ball icon) */
    .cta { display:inline-flex; align-items:center; gap:.5rem; text-decoration:none; font-weight:700; }
    .cta__ball {
      display:inline-grid; place-items:center; width: 28px; height: 28px; border-radius: 50%;
      background: var(--cbk-cta-bg); color:#fff; font-size:.9rem; line-height:1; box-shadow: inset 0 0 0 2px #fff, 0 2px 8px rgba(0,0,0,.15);
    }
    .cta__label { color: var(--cbk-accent); border-bottom: 2px solid transparent; }
    .cta:hover .cta__label { border-color: var(--cbk-accent-2); }

    /* Pill variant used on hero */
    .cta--pill { background: #fff; color:#111; padding:.5rem .75rem; border-radius: 999px; box-shadow: 0 4px 12px rgba(0,0,0,.18); }
    .cta--pill .cta__label { color:#111; }

    /* Cue-stick divider uses accent wood tones */
    .cue-divider {
      height: 2px; margin: .6rem 0 1rem;
      background: linear-gradient(to right, var(--cbk-divider-wood-1) 0%, var(--cbk-divider-wood-2) 40%, var(--cbk-divider-wood-2) 60%, var(--cbk-divider-wood-1) 100%);
      border-radius: 2px; opacity: .25;
    }

    /* Desktop: hero stays wide, list becomes two columns */
    @media (min-width: 990px){
      .post-list { display: grid; grid-template-columns: 1fr 1fr; gap: 14px 18px; }
      .cue-divider { display: none; }
      .post__card { grid-template-columns: 200px 1fr; padding: .85rem; }
      .post__img--4x3 { width: 200px; height: 150px; }
      .post__img--1x1 { width: 160px; height: 160px; }
      .post__excerpt { font-size: .98rem; }
    }

    /* Buttons to match Dawn-ish style */
    .button { display:inline-block; padding:.6rem 1rem; border-radius:999px; text-decoration:none; border:1px solid rgba(0,0,0,.12);
      font-weight:600; background: var(--color-background, #fff); color: var(--color-foreground, #111); }
    .button--secondary { background: transparent; }
    .blog-pagination { display:flex; gap:.75rem; justify-content:center; align-items:center; margin: 1rem 0 2rem; }
    .blog-pagination__page { opacity:.8; }
  </style>
</section>

{% schema %}
{
  "name": "Blog grid compact",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "The Art of Billiards" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Stories, tips, and debates from the pool hall." },

    { "type": "checkbox", "id": "show_hero", "label": "Show featured hero (latest post)", "default": true },
    {
      "type": "select", "id": "hero_ratio", "label": "Hero image ratio", "default": "16x9",
      "options": [ { "value": "16x9", "label": "16:9" }, { "value": "4x3", "label": "4:3" } ]
    },

    { "type": "checkbox", "id": "show_meta", "label": "Show meta row", "default": true },
    { "type": "checkbox", "id": "show_date", "label": "Show published date", "default": true },
    { "type": "checkbox", "id": "show_read_time", "label": "Show read time", "default": true },
    { "type": "checkbox", "id": "show_excerpt", "label": "Show excerpt", "default": true },
    { "type": "range", "id": "excerpt_length", "label": "Excerpt length (characters)", "min": 60, "max": 200, "step": 5, "default": 110 },

    {
      "type": "select", "id": "thumb_ratio", "label": "Thumbnail ratio", "default": "4x3",
      "options": [ { "value": "4x3", "label": "4:3 (recommended)" }, { "value": "1x1", "label": "1:1 Square" } ]
    },

    { "type": "image_picker", "id": "bg_image", "label": "Optional background image (felt or chalk texture)" },
    {
      "type": "select", "id": "bg_size", "label": "Background size", "default": "cover",
      "options": [ { "value": "cover", "label": "Cover" }, { "value": "contain", "label": "Contain" }, { "value": "auto", "label": "Actual size (repeatable)" } ]
    },
    {
      "type": "select", "id": "bg_position", "label": "Background position", "default": "center center",
      "options": [ { "value": "center center", "label": "Center" }, { "value": "top center", "label": "Top" }, { "value": "bottom center", "label": "Bottom" } ]
    },
    {
      "type": "select", "id": "bg_repeat", "label": "Background repeat", "default": "no-repeat",
      "options": [ { "value": "no-repeat", "label": "No repeat" }, { "value": "repeat", "label": "Repeat" }, { "value": "repeat-x", "label": "Repeat X" }, { "value": "repeat-y", "label": "Repeat Y" } ]
    },

    { "type": "range", "id": "bg_overlay", "label": "Background darken overlay (0–25%)", "min": 0, "max": 25, "step": 1, "default": 6 },

    {
      "type": "select", "id": "theme_accent", "label": "Theme accent", "default": "felt",
      "options": [ { "value": "felt", "label": "Felt green vibe" }, { "value": "chalk", "label": "Chalkboard vibe" } ]
    },

    {
      "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "background-1",
      "options": [
        { "value": "background-1", "label": "Background 1" },
        { "value": "background-2", "label": "Background 2" },
        { "value": "inverse", "label": "Inverse" },
        { "value": "accent-1", "label": "Accent 1" },
        { "value": "accent-2", "label": "Accent 2" }
      ]
    },

    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Read" },
    { "type": "text", "id": "load_more_label", "label": "Pagination next label", "default": "Older" }
  ],
  "presets": [ { "name": "Blog grid compact", "category": "Blog" } ]
}
{% endschema %}

{% stylesheet %}{% endstylesheet %}
{% javascript %}{% endjavascript %}
